"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{2255:(e,t,n)=>{n.d(t,{f:()=>r});function r(){return globalThis.thriftersClientId||(globalThis.thriftersClientId="client-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),console.log("[ClientId] Generated new client ID for this tab:",globalThis.thriftersClientId)),globalThis.thriftersClientId}},6473:(e,t,n)=>{n.d(t,{H:()=>s});var r=n(1521),o=n(8217),c=n(2255),i=n(8891);let a=new Map;function s(e,t){let[,n]=(0,r.useState)({}),s=(0,r.useCallback)(()=>{n({})},[]),l="".concat(e,"/").concat(t);a.has(l)||a.set(l,{subscribers:new Set,state:{item:null,isLoading:!0,isSaving:!1,error:null},timestampRef:{current:0},saveTimerRef:{current:null},pendingValueRef:{current:null},retryTimerRef:{current:null},loadingDebounceRef:{current:null},eventSource:null,refCount:0});let u=a.get(l),d=(0,r.useCallback)(()=>{u.subscribers.forEach(e=>e())},[u]),m=(0,r.useCallback)(e=>{Object.assign(u.state,e),d()},[u,d]),h=(0,r.useCallback)(async()=>{let n=(0,o.c4)();u.loadingDebounceRef.current&&clearTimeout(u.loadingDebounceRef.current),u.loadingDebounceRef.current=setTimeout(()=>{m({isLoading:!0})},1e3);try{let r=await fetch("/api/data/".concat(e,"/").concat(t),{headers:{Authorization:"Bearer ".concat(n)}});if(!r.ok){if(404===r.status){u.loadingDebounceRef.current&&(clearTimeout(u.loadingDebounceRef.current),u.loadingDebounceRef.current=null),m({item:null,error:"Item not found",isLoading:!1});return}console.log("[useItem ".concat(e,"/").concat(t,"] Fetch failed with ").concat(r.status,", retrying in 1s...")),u.retryTimerRef.current=setTimeout(()=>{h()},1e3);return}let{value:o,timestamp:c}=await r.json();u.loadingDebounceRef.current&&(clearTimeout(u.loadingDebounceRef.current),u.loadingDebounceRef.current=null),m({item:o,error:null,isLoading:!1}),u.timestampRef.current=c}catch(n){console.log("[useItem ".concat(e,"/").concat(t,"] Fetch error, retrying in 1s:"),n),u.retryTimerRef.current=setTimeout(()=>{h()},1e3)}},[e,t,u,m]),g=(0,r.useCallback)(()=>{u.retryTimerRef.current&&(clearTimeout(u.retryTimerRef.current),u.retryTimerRef.current=null),u.loadingDebounceRef.current&&(clearTimeout(u.loadingDebounceRef.current),u.loadingDebounceRef.current=null),m({isLoading:!0}),h()},[u,h,m]),f=(0,r.useCallback)(async(n,r)=>{try{let o=await fetch("/api/data/".concat(e,"/").concat(t),{method:"PUT",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({value:n,clientId:(0,c.f)()})});if(!o.ok)throw Error("Failed to save item: ".concat(o.status));let{timestamp:i}=await o.json();u.timestampRef.current=i,m({error:null,isSaving:!1}),u.pendingValueRef.current=null}catch(n){console.error("[useItem ".concat(e,"/").concat(t,"] Save error:"),n),m({error:n.message,isSaving:!1}),h()}},[e,t,u,h,m]),b=(0,r.useCallback)(e=>{let t=(0,o.c4)();m({item:e,isSaving:!0}),u.pendingValueRef.current={value:e,token:t},u.saveTimerRef.current&&clearTimeout(u.saveTimerRef.current),u.saveTimerRef.current=setTimeout(()=>{f(e,t)},1e3)},[u,f,m]),p=(0,r.useCallback)(async()=>{let n=(0,o.c4)();m({isSaving:!0});try{let r=await fetch("/api/data/".concat(e,"/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n)}});if(!r.ok)throw Error("Failed to delete item: ".concat(r.status));return m({item:null,error:null,isSaving:!1}),!0}catch(n){return console.error("[useItem ".concat(e,"/").concat(t,"] Delete error:"),n),m({error:n.message,isSaving:!1}),!1}},[e,t,m]);return(0,r.useEffect)(()=>{if(!t)return void console.warn("[useItem ".concat(e,"] Called with null/undefined key. Was this intended?"));if("string"!=typeof t)throw Error("[useItem] Invalid key type: ".concat(typeof t,". Key must be a string, got: ").concat(t));return u.subscribers.add(s),u.refCount++,1===u.refCount&&(m({isLoading:!0,item:null}),h()),()=>{if(u.subscribers.delete(s),u.refCount--,0===u.refCount){if(u.saveTimerRef.current&&u.pendingValueRef.current){clearTimeout(u.saveTimerRef.current);let{value:e,token:t}=u.pendingValueRef.current;f(e,t)}u.retryTimerRef.current&&(clearTimeout(u.retryTimerRef.current),u.retryTimerRef.current=null),u.loadingDebounceRef.current&&(clearTimeout(u.loadingDebounceRef.current),u.loadingDebounceRef.current=null),u.eventSource&&(u.eventSource(),u.eventSource=null),setTimeout(()=>{0===u.refCount&&a.delete(l)},1e3)}}},[e,t,l,u,s,h,m,f]),(0,r.useEffect)(()=>{if(t&&1===u.refCount&&!u.eventSource){let n=i.z.subscribe({namespace:e,key:t},e=>{if("refetch"===e.type)return void h();"item:updated"===e.type&&e.key===t&&e.timestamp>u.timestampRef.current&&h(),"item:deleted"===e.type&&e.key===t&&m({item:null})});u.eventSource=n}},[e,t,u,h,m]),{item:u.state.item,setItem:b,isLoading:u.state.isLoading,isSaving:u.state.isSaving,error:u.state.error,refetch:g,deleteItem:p}}},8217:(e,t,n)=>{n.d(t,{H1:()=>m,NG:()=>l,O5:()=>i,Px:()=>d,_9:()=>a,c4:()=>c,vv:()=>s});let r="auth_authToken",o="auth_githubToken";function c(){try{let e=localStorage.getItem(r);if(!e)return null;let t=JSON.parse(e);return(null==t?void 0:t.access_token)||null}catch(e){return console.error("Failed to get auth token:",e),null}}function i(e){try{e?localStorage.setItem(r,JSON.stringify(e)):localStorage.removeItem(r)}catch(e){console.error("Failed to set auth token:",e)}}function a(){try{let e=localStorage.getItem(r);if(!e)return null;return JSON.parse(e)}catch(e){return console.error("Failed to get auth token data:",e),null}}function s(){try{return localStorage.getItem(o)||null}catch(e){return console.error("Failed to get GitHub token:",e),null}}function l(e){try{e?localStorage.setItem(o,e):localStorage.removeItem(o)}catch(e){console.error("Failed to set GitHub token:",e)}}let u="auth_accounts";function d(){let e=localStorage.getItem(u);if(!e)return{};try{return JSON.parse(e)}catch(e){return console.error("Failed to parse accounts pool:",e),{}}}function m(e){try{localStorage.setItem(u,JSON.stringify(e))}catch(e){console.error("Failed to save accounts pool:",e)}}},8891:(e,t,n)=>{n.d(t,{z:()=>u});let r=new Map,o=null,c="sse-connection-modal";function i(){let e=function(){for(let e of r.values())if("disconnected"===e||"reconnecting"===e)return!0;return!1}();e&&!o?function(){if(document.getElementById(c))return;(o=document.createElement("div")).id=c,o.style.cssText="\n    position: fixed;\n    inset: 0;\n    background: rgba(15, 23, 42, 0.95);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 9999;\n  ";let e=document.createElement("div");e.style.cssText="\n    background: rgb(30, 41, 59);\n    border-radius: 0.5rem;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\n    border: 1px solid rgb(51, 65, 85);\n    max-width: 28rem;\n    width: 100%;\n    margin: 1rem;\n    padding: 2rem;\n  ";let t=document.createElement("div");t.style.cssText="\n    display: flex;\n    justify-content: center;\n    margin-bottom: 1rem;\n  ";let n=document.createElement("div");if(n.style.cssText="\n    width: 3rem;\n    height: 3rem;\n    border: 2px solid transparent;\n    border-top-color: rgb(59, 130, 246);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n  ",t.appendChild(n),!document.getElementById("sse-modal-styles")){let e=document.createElement("style");e.id="sse-modal-styles",e.textContent="\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(e)}let r=document.createElement("h3");r.textContent="Connection Lost",r.style.cssText="\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: rgb(226, 232, 240);\n    text-align: center;\n    margin-bottom: 0.5rem;\n  ";let i=document.createElement("p");i.textContent="Attempting to reconnect to the server...",i.style.cssText="\n    color: rgb(203, 213, 225);\n    text-align: center;\n    margin-bottom: 1.5rem;\n  ";let a=document.createElement("button");a.textContent="Refresh Page",a.style.cssText="\n    width: 100%;\n    padding: 0.75rem 1rem;\n    background: rgb(37, 99, 235);\n    color: white;\n    border-radius: 0.375rem;\n    border: none;\n    cursor: pointer;\n    font-weight: 500;\n    font-size: 1rem;\n    transition: background-color 0.2s;\n  ",a.onmouseover=()=>{a.style.background="rgb(29, 78, 216)"},a.onmouseout=()=>{a.style.background="rgb(37, 99, 235)"},a.onclick=()=>{window.location.reload()};let s=document.createElement("p");s.textContent="If this persists, please check your internet connection",s.style.cssText="\n    color: rgb(148, 163, 184);\n    font-size: 0.875rem;\n    text-align: center;\n    margin-top: 1rem;\n  ",e.appendChild(t),e.appendChild(r),e.appendChild(i),e.appendChild(a),e.appendChild(s),o.appendChild(e),document.body.appendChild(o)}():!e&&o&&o&&o.parentNode&&(o.parentNode.removeChild(o),o=null)}var a=n(8217),s=n(2255);class l{subscribe(e,t){let n=this.nextSubscriptionId++;return this.subscribers.set(n,{filter:e,callback:t}),1===this.subscribers.size&&this._connect(),()=>{this.subscribers.delete(n)}}_setState(e){if(this.currentState!==e){var t;this.currentState=e,console.log("[SSE Manager] State changed to: ".concat(e)),this.connectionId&&(t=this.connectionId,r.has(t)&&(r.set(t,e),i()))}}_isConnectionDead(){let e=Date.now()-this.lastMessageTime;return this.eventSource&&this.eventSource.readyState===EventSource.CLOSED||e>15e3}_resetHeartbeat(){this.lastMessageTime=Date.now(),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=setTimeout(()=>{console.log("[SSE Manager] No heartbeat for 15s - connection is dead"),this._setState("disconnected"),this._reconnect()},15e3)}_connect(){if(this.eventSource)return;let e=(0,a._9)();if(this.username=null==e?void 0:e.username,this.clientId=(0,s.f)(),!this.username)return void console.error("[SSE Manager] Cannot connect without username");this.connectionId||(this.connectionId=function(){let e="conn-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9));return r.set(e,"connected"),i(),e}(),this.currentState="connected");let t="/api/sse/stream?username=".concat(encodeURIComponent(this.username),"&clientId=").concat(encodeURIComponent(this.clientId));this.eventSource=new EventSource(t),this.eventSource.onopen=()=>{this.reconnectAttempts=0,this._setState("connected"),console.log("[SSE Manager] Connected - triggering refetch for all subscriptions"),this._dispatchEvent({type:"refetch"})},this.eventSource.onmessage=e=>{this._resetHeartbeat();let t=JSON.parse(e.data);"heartbeat"!==t.type&&this._dispatchEvent(t)},this.eventSource.onerror=()=>{console.log("[SSE Manager] Connection error"),this._setState("disconnected"),this._reconnect()},this._resetHeartbeat()}_dispatchEvent(e){this.subscribers.forEach(t=>{let{filter:n,callback:r}=t;if(this._eventMatchesFilter(e,n))try{r(e)}catch(e){console.error("[SSE Manager] Error in subscriber callback:",e)}})}_eventMatchesFilter(e,t){return!t||"refetch"===e.type||(!t.namespace||e.namespace===t.namespace)&&(!t.key||e.key===t.key)}_reconnect(){this._setState("reconnecting"),this.eventSource&&(this.eventSource.close(),this.eventSource=null),clearTimeout(this.heartbeatTimer),clearTimeout(this.reconnectTimer),this.reconnectAttempts++,console.log("[SSE Manager] Reconnecting in ".concat(1e3,"ms (attempt ").concat(this.reconnectAttempts,")...")),this.reconnectTimer=setTimeout(()=>{this._connect()},1e3)}_disconnect(){if(this.eventSource&&(this.eventSource.close(),this.eventSource=null),clearTimeout(this.heartbeatTimer),clearTimeout(this.reconnectTimer),this.connectionId){var e;e=this.connectionId,r.delete(e),i(),this.connectionId=null}}_handleVisibilityChange(){"visible"===document.visibilityState&&this._isConnectionDead()&&(console.log("[SSE Manager] Connection dead on tab focus, reconnecting immediately..."),this.eventSource&&(this.eventSource.close(),this.eventSource=null),clearTimeout(this.heartbeatTimer),clearTimeout(this.reconnectTimer),this.reconnectAttempts=0,this._setState("reconnecting"),this._connect())}constructor(){this.eventSource=null,this.subscribers=new Map,this.nextSubscriptionId=0,this.heartbeatTimer=null,this.reconnectTimer=null,this.reconnectAttempts=0,this.lastMessageTime=Date.now(),this.currentState="disconnected",this.connectionId=null,this.username=null,this.clientId=null,"undefined"!=typeof document&&document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this))}}let u=new l},9838:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(3365),o=n(1521);function c(e){let{isOpen:t,onClose:n,onConfirm:c,title:i,message:a,type:s="confirm",confirmText:l="OK",cancelText:u="Cancel"}=e;return((0,o.useEffect)(()=>{let e=e=>{t&&("Escape"===e.key?n():("Enter"===e.key||" "===e.key)&&(e.preventDefault(),c&&c(),n()))};return t&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[t,n,c]),t)?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,r.jsxs)("div",{className:"bg-slate-800 rounded-lg shadow-xl border border-slate-700 max-w-md w-full mx-4",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-slate-700",children:(0,r.jsx)("h3",{className:"text-lg font-semibold text-slate-100",children:i})}),(0,r.jsx)("div",{className:"px-6 py-4 max-h-96 overflow-y-auto",children:"string"==typeof a?a.split("\\n").map((e,t)=>(0,r.jsx)("p",{className:"text-slate-300 leading-relaxed break-words whitespace-pre-wrap",children:e||"\xa0"},t)):(0,r.jsx)("div",{className:"text-slate-300 leading-relaxed break-words",children:a})}),(0,r.jsxs)("div",{className:"px-6 py-4 border-t border-slate-700 flex justify-end gap-3",children:["confirm"===s&&(0,r.jsx)("button",{onClick:()=>{n()},className:"px-4 py-2 text-slate-300 hover:text-slate-100 border border-slate-600 hover:border-slate-500 rounded-md transition-colors",children:u}),(0,r.jsx)("button",{onClick:()=>{c&&c(),n()},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:l})]})]})}):null}}}]);