"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81],{1691:(e,t,r)=>{r.d(t,{O:()=>l,v:()=>n});var s=r(6784);let n=(0,s.F)({results:{}},{store:!0,compress:!0,namespace:"research"}),l=(0,s.F)({activeSearch:"",loading:!1,triggerSearch:""})},5301:(e,t,r)=>{r.r(t),r.d(t,{default:()=>P,usePageState:()=>A});var s=r(3365),n=r(7192),l=r(1521),i=r(763),o=r(6784);function a(){let{activeView:e,setActiveView:t}=A(),r={research:{name:"Research",icon:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,s.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})},notes:{name:"Notes",icon:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})},inventory:{name:"Inventory",icon:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M4 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5z"}),(0,s.jsx)("path",{d:"M4 13a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6z"}),(0,s.jsx)("path",{d:"M16 13a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-6z"})]})}};return(0,s.jsx)("div",{className:"flex bg-slate-700 rounded w-full sm:w-auto h-10",children:Object.entries(r).map((n,l)=>{let[i,o]=n;return(0,s.jsxs)("button",{onClick:()=>t(i),className:"flex items-center gap-2 px-3 font-medium transition-all flex-1 sm:flex-none justify-center h-full ".concat(0===l?"rounded-l":""," ").concat(l===Object.entries(r).length-1?"rounded-r":""," ").concat(e===i?"bg-blue-600 text-white shadow":"text-slate-300 hover:text-white hover:bg-slate-600"),children:[o.icon,(0,s.jsx)("span",{className:"truncate",children:o.name})]},i)})})}let c=m(),d=(0,o.F)({notepads:{[c]:{name:"Notepad 1",content:""}}},{store:!0,compress:!0,namespace:"notes"}),u=(0,o.F)({activeNotepadId:c}),h=(0,o.F)({hasFocus:!1,selection:{chars:0,words:0,isCurrentLine:!1},documentStats:{chars:0,words:0}});function m(){return"notepad-".concat(Date.now())}function x(e){return 0===e.replace(/<br\s*\/?>/gi,"").trim().length}function p(){let{documentStats:e,selection:t,hasFocus:r}=h();return(0,s.jsxs)("div",{className:"flex items-center sm:gap-2 flex-wrap sm:flex-nowrap",children:[(0,s.jsx)("div",{className:"w-full sm:w-auto mb-2 sm:mb-0 sm:mr-4",children:(0,s.jsx)(a,{})}),(0,s.jsx)("div",{className:"ml-auto text-sm bg-slate-700 text-slate-100 px-3 py-1.5 rounded shadow w-full sm:w-auto",children:r?"".concat(t.isCurrentLine?"Line: ":"Selection: ").concat(t.words," words, ").concat(t.chars," chars"):"Document: ".concat(e.words," words, ").concat(e.chars," chars")})]})}var f=r(9838);function g(){var e;let{notepads:t,setNotepads:r}=d(),{activeNotepadId:n,setActiveNotepadId:i}=u(),[o,a]=(0,l.useState)(null),[c,h]=(0,l.useState)(""),[x,p]=(0,l.useState)(null),[g,w]=(0,l.useState)(null),[v,b]=(0,l.useState)(null),[j,y]=(0,l.useState)(null),[k,N]=(0,l.useState)(!1),[C,L]=(0,l.useState)(null);function S(){o&&c.trim()&&r({...t,[o]:{...t[o],name:c.trim()}}),a(null),h("")}function E(e){"Enter"===e.key?(e.preventDefault(),S()):"Escape"===e.key&&(e.preventDefault(),a(null),h(""))}function D(){w(null)}function T(){p(null),w(null)}function I(e){if(!j||!v)return;let t=e.touches[0],r=Math.abs(t.clientX-v.x),s=Math.abs(t.clientY-v.y);if(r>10&&r>s){p(j);let e=document.elementFromPoint(t.clientX,t.clientY),r=null==e?void 0:e.closest("[data-notepad-id]");if(r){let e=r.getAttribute("data-notepad-id");e&&e!==j?w(e):w(null)}else w(null)}}function M(e){j&&g&&j!==g&&R(j,g),b(null),y(null),p(null),w(null)}function R(e,s){let n=Object.entries(t),l=n.findIndex(t=>{let[r]=t;return r===e}),i=n.findIndex(e=>{let[t]=e;return t===s});if(-1===l||-1===i)return;let[o]=n.splice(l,1);n.splice(i,0,o);let a={};n.forEach(e=>{let[t,r]=e;a[t]=r}),r(a)}return(0,l.useEffect)(()=>{let e=Object.keys(t);n&&t[n]||i(e[0])},[t,n,i]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative px-4 h-10",children:[(0,s.jsxs)("div",{className:"flex items-end overflow-x-auto scrollbar-hide h-10",children:[(0,s.jsx)("button",{className:"px-3 h-8 rounded-md bg-slate-700 hover:bg-slate-600 text-slate-400 hover:text-slate-200 text-lg flex items-center justify-center self-center mr-1",onClick:function(){let e=m();r({[e]:{name:function(e){let t=new Set(Object.values(e).map(e=>e.name)),r=1,s="Notepad ".concat(r);for(;t.has(s);)r++,s="Notepad ".concat(r);return s}(t),content:""},...t}),i(e)},title:"Add new notepad",children:"+"}),Object.entries(t).map(e=>{let[r,l]=e;return(0,s.jsxs)("button",{"data-notepad-id":r,draggable:o!==r,onDragStart:e=>{p(r),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/html",r)},onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",w(r)},onDragLeave:D,onDrop:e=>{e.preventDefault(),x&&x!==r&&R(x,r),p(null),w(null)},onDragEnd:T,onTouchStart:e=>(function(e,t){if(o===t)return;let r=e.touches[0];b({x:r.clientX,y:r.clientY}),y(t)})(e,r),onTouchMove:I,onTouchEnd:M,className:"px-4 h-full rounded-t-md mr-1 transition-colors flex items-center ".concat(r===n?"bg-slate-800 text-slate-100":"bg-slate-700 text-slate-300 hover:bg-slate-600"," ").concat(x===r?"opacity-50":""," ").concat(g===r&&x!==r?"!bg-blue-600":""),onClick:()=>i(r),title:o!==r?"Drag to reorder, click to select, double-click to rename":"",children:[o===r?(0,s.jsx)("input",{type:"text",value:c,onChange:e=>h(e.target.value),onKeyDown:E,onBlur:S,className:"bg-transparent border-b border-slate-500 outline-none w-24 px-1",autoFocus:!0,onClick:e=>e.stopPropagation()}):(0,s.jsx)("span",{onDoubleClick:()=>{var e;a(r),h((null==(e=t[r])?void 0:e.name)||"")},className:"cursor-pointer hover:underline whitespace-nowrap",title:"Double-click to edit",children:l.name}),Object.keys(t).length>1&&!o&&(0,s.jsx)("span",{className:"ml-2 text-slate-400 hover:text-slate-200",onClick:e=>{e.stopPropagation(),L(r),N(!0)},children:"\xd7"})]},r)})]}),(0,s.jsx)("div",{className:"absolute top-0 right-4 w-8 h-10 bg-gradient-to-l from-slate-900 to-transparent pointer-events-none"})]}),(0,s.jsx)(f.A,{isOpen:k,onClose:function(){N(!1),L(null)},onConfirm:function(){if(C){let e={...t};delete e[C],r(e),L(null)}},title:"Delete Notepad",message:'Are you sure you want to delete "'.concat(C?null==(e=t[C])?void 0:e.name:"",'"?\n\nThis action cannot be undone.'),type:"confirm",confirmText:"Delete",cancelText:"Cancel"})]})}function w(){let{notepads:e,setNotepads:t}=d(),{activeNotepadId:r}=u(),{setHasFocus:n,setSelection:i,setDocumentStats:o}=h(),a=(0,l.useRef)(null),c=(0,l.useRef)(!1),m=r?e[r]:null,p=()=>{if(!a.current)return;let e=a.current.textContent||"";if(x(a.current.innerHTML))return void o({chars:0,words:0});o({chars:e.length,words:e.trim()?e.trim().split(/\s+/).filter(Boolean).length:0})},f=()=>{a.current&&r&&(c.current=!0,t({...e,[r]:{...e[r],content:a.current.innerHTML}}),c.current=!1,p())},g=()=>{let e=window.getSelection(),t=e?e.toString():"";if(e&&t.length>0)i({chars:t.length,words:t.trim().split(/\s+/).filter(Boolean).length,isCurrentLine:!1});else if(e&&e.anchorNode){let t="";try{let r=e.anchorNode;r.nodeType===Node.TEXT_NODE?t=r.textContent||"":(t=r.textContent||"",r.innerHTML&&x(r.innerHTML)&&(t=""))}catch(e){t=""}i({chars:t.length,words:t.trim()?t.trim().split(/\s+/).filter(Boolean).length:0,isCurrentLine:!0})}else i({chars:0,words:0,isCurrentLine:!1})};return((0,l.useEffect)(()=>{if(r){if(a.current&&m){let e=m.content||"";a.current.innerHTML!==e&&(a.current.innerHTML=e,p())}return document.addEventListener("selectionchange",g),()=>{document.removeEventListener("selectionchange",g)}}},[r,null==m?void 0:m.content]),m)?(0,s.jsx)("div",{className:"h-full px-4 pb-0",children:(0,s.jsx)("div",{className:"h-full bg-slate-800 text-slate-100 cursor-text relative rounded-md shadow-md",onClick:()=>{a.current&&a.current.focus()},children:(0,s.jsx)("div",{ref:a,className:"w-full h-full outline-none p-4 overflow-auto",style:{whiteSpace:"pre-wrap"},contentEditable:!0,onInput:f,onFocus:()=>{n(!0)},onBlur:()=>{n(!1)},onPaste:e=>{e.preventDefault();let t=e.clipboardData||window.clipboardData,r=t.getData("text/html");if(!r){if(r=t.getData("text/plain")){let e=window.getSelection();if(e.rangeCount>0){let t=e.getRangeAt(0);t.deleteContents();let s=r.split("\n"),n=document.createDocumentFragment();s.forEach((e,t)=>{e.trim()&&n.appendChild(document.createTextNode(e)),t<s.length-1&&n.appendChild(document.createElement("br"))}),t.insertNode(n),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}f()}return}let s=document.createElement("div");if(s.innerHTML=r,s.querySelectorAll("*").forEach(e=>{e.style&&(e.style.removeProperty("color"),e.style.removeProperty("background-color"),e.style.removeProperty("background"))}),a.current){let e=s.innerHTML,t=window.getSelection();if(t.rangeCount>0){let r=t.getRangeAt(0),s=document.createElement("span");s.id="paste-marker-temp",r.insertNode(s);let n=a.current.innerHTML.replace('<span id="paste-marker-temp"></span>',e);a.current.innerHTML=n;let l=window.getSelection(),i=document.createRange();i.selectNodeContents(a.current),i.collapse(!1),l.removeAllRanges(),l.addRange(i)}else a.current.innerHTML+=e}f()},onCopy:e=>{let t=window.getSelection();if(0===t.rangeCount)return;let r=t.getRangeAt(0).cloneContents(),s=document.createElement("div");s.appendChild(r),s.querySelectorAll("*").forEach(e=>{e.style&&(e.style.removeProperty("color"),e.style.removeProperty("background-color"),e.style.removeProperty("background"))}),e.clipboardData.setData("text/html",s.innerHTML),e.clipboardData.setData("text/plain",s.textContent||s.innerText),e.preventDefault()},suppressContentEditableWarning:!0})})}):null}function v(){return(0,s.jsxs)("div",{className:"h-full overflow-auto custom-scrollbar flex flex-col",children:[(0,s.jsx)(g,{}),(0,s.jsx)("div",{className:"flex-1 min-h-0",children:(0,s.jsx)(w,{})})]})}var b=r(1691);function j(){let{activeSearch:e,loading:t,triggerSearch:r,setActiveSearch:n,setLoading:i,setTriggerSearch:o}=(0,b.O)(),{results:c,setResults:d}=(0,b.v)(),[u,h]=(0,l.useState)("");async function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u;if(e.trim()){if(i(!0),n(e),!c[e])try{let t=await fetch("/api/search/".concat(encodeURIComponent(e),"/60"));if(!t.ok){console.error("Search failed: ".concat(t.status," ").concat(t.statusText)),alert("Search failed - please try again."),i(!1);return}let r=await t.json(),s={...c,[e]:r.results},n=Object.keys(s);n.length>10&&n.slice(0,n.length-10).forEach(e=>{delete s[e]}),d(s)}catch(e){console.error("Search error:",e),alert("Search failed - please try again."),i(!1);return}i(!1)}}return(0,l.useEffect)(()=>{if(c&&Object.keys(c).length>0){let r=Object.keys(c),s=r[r.length-1];e&&(c[e]||t)||n(s)}},[c,e,t,n]),(0,l.useEffect)(()=>{e&&h(e)},[e]),(0,l.useEffect)(()=>{r&&r.trim()&&(h(r),m(r),o(""))},[r,h,o]),(0,s.jsxs)("div",{className:"flex items-center sm:gap-2 flex-wrap sm:flex-nowrap",children:[(0,s.jsx)("div",{className:"w-full sm:w-auto mb-2 sm:mb-0 sm:mr-4",children:(0,s.jsx)(a,{})}),(0,s.jsxs)("div",{className:"w-full flex flex-wrap sm:flex-nowrap gap-2",children:[(0,s.jsxs)("div",{className:"input-container flex-1 h-10 w-full relative",children:[(0,s.jsx)("input",{type:"text",value:u,onChange:e=>h(e.target.value),onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),m())},placeholder:"Search eBay...",disabled:t,className:"w-full bg-transparent border-0 outline-none pr-4 ".concat(t?"text-slate-400 cursor-not-allowed":"text-slate-100")}),u&&!t&&(0,s.jsx)("button",{onClick:function(){h("")},className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-200 transition-colors",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,s.jsx)("div",{className:"flex gap-2 ml-auto",children:(0,s.jsxs)("button",{className:"btn btn-accent h-10 px-3 py-0 shrink-0 flex items-center gap-1 ".concat(t?"opacity-50 cursor-not-allowed":""),disabled:t,onClick:()=>m(),children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,s.jsx)("path",{d:"m21 21-4.35-4.35"})]}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Search"})]})})]})]})}function y(){let{activeSearch:e,setActiveSearch:t}=(0,b.O)(),{results:r,setResults:n}=(0,b.v)(),[i,o]=(0,l.useState)(!1);return 0===Object.keys(r).length?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative px-4 pb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide",children:[(0,s.jsx)("button",{onClick:function(){o(!0)},className:"px-2 py-2 rounded-md bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-slate-200 flex-shrink-0",title:"Clear all history",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M3 6h18"}),(0,s.jsx)("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),(0,s.jsx)("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})]})}),Object.keys(r).slice(-10).reverse().map((l,i)=>(0,s.jsxs)("div",{className:"px-3 py-1.5 rounded-md cursor-pointer flex-shrink-0 flex items-center gap-2 ".concat(l===e?"bg-green-600 text-white":"bg-slate-800 hover:bg-slate-700 text-slate-100"),children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"flex-shrink-0",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,s.jsx)("path",{d:"m21 21-4.35-4.35"})]}),(0,s.jsx)("span",{onClick:()=>{t(l)},className:"flex-grow",children:(0,s.jsx)("span",{title:l,children:l.length>30?"".concat(l.slice(0,29).trim(),"…"):l})}),(0,s.jsx)("span",{className:"ml-2 ".concat(l===e?"text-white/80 hover:text-white":"text-slate-400 hover:text-slate-200"),onClick:e=>{e.stopPropagation();let t={...r};delete t[l],n(t)},children:"\xd7"})]},i))]}),(0,s.jsx)("div",{className:"absolute top-0 right-4 w-8 h-full bg-gradient-to-l from-slate-900 to-transparent pointer-events-none"})]}),(0,s.jsx)(f.A,{isOpen:i,onClose:function(){o(!1)},onConfirm:function(){n({}),t("")},title:"Clear Search History",message:"Are you sure you want to clear all search history?\\n\\nThis action cannot be undone.",type:"confirm",confirmText:"Clear All",cancelText:"Cancel"})]})}function k(e){return e.toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}function N(e){let{title:t,condition:r,link:n,image:l,price:i,shipping:o,total:a,sold:c,soldDateString:d,bestOffer:u}=e;return(0,s.jsxs)("div",{className:"flex items-start gap-4 p-3 bg-slate-900/40 rounded-md hover:bg-slate-900/70 transition-colors",children:[(0,s.jsx)("div",{className:"w-32 h-32 flex-shrink-0 overflow-hidden relative rounded-md",children:(0,s.jsx)("img",{className:"absolute w-full h-full object-cover",src:l,alt:t})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[c&&d&&(0,s.jsx)("div",{className:"text-slate-300 text-sm",children:d}),(0,s.jsx)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"group hover:text-green-400 transition-colors",children:(0,s.jsxs)("h3",{className:"font-medium break-words inline-block",children:[t,(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 inline-block ml-1 -mt-0.5 opacity-70 group-hover:opacity-100",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})}),(0,s.jsx)("div",{className:"Parts only"===r?"text-red-400 text-sm":"text-blue-300 text-sm",children:r}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:c?u?"text-green-500 line-through":"text-green-500 font-medium":"text-blue-400 font-medium",children:["\xa3",k(a)]}),(0,s.jsxs)("div",{className:"text-slate-400 text-sm italic",children:["\xa3",k(i)," + \xa3",k(o)," p&p"]})]})]})]})}function C(e){let{url:t,items:r,name:n}=e;return(0,s.jsxs)("div",{className:"h-full",children:[(0,s.jsxs)("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-xl font-medium mb-4 text-slate-100 hover:text-green-400 transition-colors",children:[(0,s.jsx)("h2",{children:n}),(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]}),(0,s.jsx)("div",{className:"space-y-4",children:r.map((e,t)=>(0,s.jsx)(N,{...e},t))})]})}function L(){let{activeSearch:e,loading:t}=(0,b.O)(),{results:r}=(0,b.v)();return t?(0,s.jsx)("div",{className:"flex overflow-x-auto gap-4 mx-4 sm:ml-4 sm:mr-2 pb-0 sm:flex-nowrap h-full",children:[1,2,3].map(e=>(0,s.jsxs)("div",{className:"min-w-full sm:min-w-0 flex-1 bg-slate-800 p-4 rounded-md shadow-md animate-pulse h-full flex flex-col",children:[(0,s.jsx)("div",{className:"h-6 bg-slate-700 rounded mb-4 w-3/4 flex-shrink-0"}),(0,s.jsx)("div",{className:"space-y-3 flex-1 overflow-hidden",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(e=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-4 bg-slate-700 rounded w-full"}),(0,s.jsx)("div",{className:"h-3 bg-slate-700 rounded w-2/3"})]},e))})]},e))}):r&&r[e]&&!t?(0,s.jsx)("div",{className:"flex overflow-x-auto gap-4 mx-4 sm:ml-4 sm:mr-2 pb-0 sm:flex-nowrap scroll-snap-x scroll-smooth",children:r[e].map((e,t)=>{let{name:r,url:n,items:l}=e;return(0,s.jsx)("div",{className:"min-w-full sm:min-w-0 flex-1 bg-slate-800 p-4 rounded-md shadow-md scroll-snap-start",children:(0,s.jsx)(C,{name:r,url:n,items:l})},t)})}):null}function S(){return(0,s.jsxs)("div",{className:"h-full overflow-auto custom-scrollbar flex flex-col",children:[(0,s.jsx)(y,{}),(0,s.jsx)("div",{className:"flex-1 min-h-0",children:(0,s.jsx)(L,{})})]})}var E=r(4363);async function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"eBay API call failed",r=await fetch(e),s=await r.json();if(!r.ok||!0!==s.success)throw Error(s.error||t);return s}async function T(e,t){var r,s;let n=await D("/api/ebay/item?token=".concat(encodeURIComponent(t),"&itemId=").concat(e),"Failed to fetch item details");if(!n.data||!n.data.Item)throw Error("Invalid API response for item ".concat(e," - missing Item data"));let l=n.data.Item;if(!l.Title)throw Error("Invalid API response for item ".concat(e," - missing Title"));if(!(null==(s=l.SellingStatus)||null==(r=s.CurrentPrice)?void 0:r.value))throw Error("Invalid API response for item ".concat(e," - missing Price"));let i={id:e,title:l.Title,price:l.SellingStatus.CurrentPrice.value,quantity:l.Quantity||0,pictureURL:null,fetchedAt:new Date().toISOString(),rawData:function(e){var t,r;if(!e||!e.Item)return{};let s=e.Item;return{Item:{ItemID:s.ItemID,Title:s.Title,Description:s.Description,SellingStatus:s.SellingStatus,Quantity:s.Quantity,PrimaryCategory:s.PrimaryCategory,PictureDetails:s.PictureDetails,PictureURL:s.PictureURL,ItemSpecifics:s.ItemSpecifics,ListingDetails:{StartTime:null==(t=s.ListingDetails)?void 0:t.StartTime,EndTime:null==(r=s.ListingDetails)?void 0:r.EndTime}}}}(n.data)};return l.PictureDetails&&(i.pictureURL=l.PictureDetails.PhotoDisplay||l.PictureDetails.GalleryURL||(Array.isArray(l.PictureDetails.PictureURL)?l.PictureDetails.PictureURL[0]:l.PictureDetails.PictureURL)),!i.pictureURL&&l.PictureURL&&(i.pictureURL=Array.isArray(l.PictureURL)?l.PictureURL[0]:l.PictureURL),i}function I(){let{authToken:e,githubToken:t}=(0,E.m1)(),{syncing:r,loadingItemIds:i,isPublishing:o,setSyncing:c,setLoadingItemIds:d,setIsPublishing:u,setInventoryData:h}=(0,E.Xf)(),{syncData:m,setSyncData:x}=(0,E.Cd)(),{setAuthToken:p}=(0,E.m1)(),f=(0,n.useSearchParams)(),g=(0,n.useRouter)(),w=()=>e&&e.expiryTime?e.expiryTime-Date.now():0,v=()=>w()>=E.fT.FIVE_MINUTES,b=async()=>{if(!(null==e?void 0:e.refresh_token))return console.log("[Token Refresh] No refresh token available"),!1;try{console.log("[Token Refresh] Refreshing access token...");let t=await fetch("/api/ebay/refresh-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refresh_token})}),r=await t.json();if(!r.success)return console.log("[Token Refresh] Failed:",r.error),!1;{console.log("[Token Refresh] Success! Tokens refreshed successfully");let t=Date.now()+1e3*r.data.expires_in,s={access_token:r.data.access_token,refresh_token:r.data.refresh_token||e.refresh_token,expires_in:r.data.expires_in,expiryTime:t,token_type:r.data.token_type||"User Access Token"};return p(s),console.log("[Token Refresh] New expiry:",new Date(t)),!0}}catch(e){return console.log("[Token Refresh] Error:",e),!1}},j=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(t.length>0){let e=t.join("\n");alert("".concat(t.length," item").concat(t.length>1?"s":""," failed to fetch:\n").concat(e))}try{let t=await fetch("/api/ebay/analytics?token=".concat(encodeURIComponent(e.access_token))),r=await t.json();if(t.ok&&Object.keys(r).length>0){let e=Object.entries(r).map(e=>{let[t,r]=e;return"".concat(t,": ").concat(r)}).join("\n");alert("API rate limits are active. Reset times:\n\n".concat(e))}}catch(e){console.error("Failed to check analytics:",e)}},y=async()=>{c(!0);try{let{rawListings:t,lastSynced:r}=m,s=[];if(r){let t=new Date(r).toISOString(),n=await D("/api/ebay/events?token=".concat(encodeURIComponent(e.access_token),"&from=").concat(t),"Failed to fetch events");n.itemIds&&(s=n.itemIds,console.log("Items with events since last sync:",s))}let n=await D("/api/ebay/items?token=".concat(encodeURIComponent(e.access_token)),"Failed to fetch item IDs"),l=n.itemIds&&Array.isArray(n.itemIds)?n.itemIds:[],i=[];for(let e of s)l.includes(e)&&i.push(e);for(let e of l)t[e]||i.push(e);let o=[...new Set(i)],a=await k(o),c={};l.forEach(e=>{t[e]&&(c[e]=t[e])}),Object.assign(c,a),x({lastSynced:Date.now(),rawListings:c}),console.log("Cache updated: ".concat(Object.keys(t).length," -> ").concat(Object.keys(c).length," (removed obsolete, added ").concat(Object.keys(a).length," new)"))}catch(e){console.error("Error fetching inventory:",e),await j()}finally{c(!1)}},k=async t=>{if(0===t.length)return{};d(t);let r=[...t],s=0,n=0,l=[],i={},o=async()=>{for(;r.length>0&&0===l.length;){let t=r.pop();s++;try{let r=await T(t,e.access_token);r&&(i[t]=r)}catch(e){console.error("Error fetching details for item ".concat(t,":"),e),l.push(e.message)}finally{s--,n++,d([...r])}}},a=[];for(let e=0;e<Math.min(5,t.length);e++)a.push(o());if(await Promise.all(a),l.length>0)throw await j(l),Error("Sync aborted after failures to prevent API blocking");return i},N=async()=>{u(!0);try{let{rawListings:e}=m,r=Object.values(e),s=await fetch("/api/ebay/save-static-inventory",{method:"POST",headers:{"Content-Type":"application/json","x-github-token":t},body:JSON.stringify(r)}),n=await s.json();if(s.ok)alert("Shop published successfully!");else throw Error(n.message||"Failed to publish shop")}catch(e){console.error("Error publishing shop:",e),alert("Error: ".concat(e.message))}finally{u(!1)}};return(0,l.useEffect)(()=>{let e=f.get("success"),t=f.get("access_token"),r=f.get("refresh_token"),s=f.get("expires_in"),n=f.get("token_type");if("true"===e&&t){let e=Date.now()+1e3*parseInt(s||"7200");p({access_token:t,refresh_token:r||"",expires_in:parseInt(s||"7200"),expiryTime:e,token_type:n||"User Access Token"}),g.replace("/?view=inventory"),console.log("[Auth] OAuth callback processed successfully")}},[f,g,p]),(0,l.useEffect)(()=>{let{rawListings:e}=m,t=Object.values(e);t.length>0?h(function(e){let t={items:{},attributes:{},categoryOptions:[],categoryGroups:{},itemsByCategory:{}};return e.forEach(e=>{if(!e||!e.id)return;let r=function(e){var t,r,s;let n={};if(null==(s=e.rawData)||null==(r=s.Item)||null==(t=r.ItemSpecifics)?void 0:t.NameValueList){let t=e.rawData.Item.ItemSpecifics.NameValueList;Array.isArray(t)&&t.forEach(e=>{e.Name&&e.Value&&(n[e.Name]=e.Value)})}return n}(e),s=function(e){var t,r,s;if(null==(s=e.rawData)||null==(r=s.Item)||null==(t=r.PrimaryCategory)?void 0:t.CategoryName){let t=e.rawData.Item.PrimaryCategory.CategoryName,r=t.split(":").map(e=>e.trim()),s=r[r.length-1],n=r.length>1?r[r.length-2]:null;return{main:r[0]||"Uncategorized",sub:r[1]||null,parent:n,leaf:s||null,full:t,parts:r}}return{main:"Uncategorized",sub:null,parent:null,leaf:null,full:"Uncategorized",parts:["Uncategorized"]}}(e),n=[e.title||"",s.leaf||"",s.parent||"",s.main||""];Object.values(r).forEach(e=>{Array.isArray(e)?n.push(...e.map(e=>e.toString())):n.push(e.toString())});let l=n.join(" ").toLowerCase();if(!e.rawData||!e.rawData.Item)throw console.error("[DEBUG] Malformed listing - missing rawData.Item for ID:",e.id),console.error("[DEBUG] Full listing object:",JSON.stringify(e,null,2)),Error("Malformed listing data for item ".concat(e.id," - missing rawData.Item"));let i=e.rawData.Item;if(!i.Description)throw console.error("[DEBUG] Missing Description for item ID:",e.id),console.error("[DEBUG] Full itemData structure:",JSON.stringify(i,null,2)),console.error("[DEBUG] Full listing object:",JSON.stringify(e,null,2)),Error("Missing Description for item ".concat(e.id));t.items[e.id]={id:e.id,title:e.title,price:e.price,description:e.rawData.Item.Description,pictureURLs:Array.isArray(e.rawData.Item.PictureDetails.PictureURL)?e.rawData.Item.PictureDetails.PictureURL:[e.rawData.Item.PictureDetails.PictureURL],specifics:r,searchText:l};let o=s.leaf||s.sub||s.main,a=s.parent||s.main;s.main,t.items[e.id].categoryInfo=s;let c="".concat(a,":").concat(o);t.items[e.id].categoryKey=c,t.categoryGroups[a]||(t.categoryGroups[a]={count:0,types:{}}),t.categoryGroups[a].types[o]||(t.categoryGroups[a].types[o]={name:o,count:0,itemIds:[]}),t.categoryGroups[a].count++,t.categoryGroups[a].types[o].count++,t.categoryGroups[a].types[o].itemIds.push(e.id),t.itemsByCategory[c]||(t.itemsByCategory[c]=[]),t.itemsByCategory[c].push(e.id),Object.entries(r).forEach(r=>{let[s,n]=r;if(!n)return;let l=s.trim();(Array.isArray(n)?n:[n]).forEach(r=>{r=r.toString().trim(),t.attributes[l]||(t.attributes[l]={name:l,values:{}}),t.attributes[l].values[r]||(t.attributes[l].values[r]={name:r,itemIds:[]}),t.attributes[l].values[r].itemIds.push(e.id)})})}),Object.entries(t.categoryGroups).sort((e,t)=>t[1].count-e[1].count).forEach(e=>{let[r,s]=e;t.categoryOptions.push({value:"",label:r,count:s.count,isGroup:!0}),Object.values(s.types).sort((e,t)=>e.name.localeCompare(t.name)).forEach(e=>{let s="".concat(r,":").concat(e.name);t.categoryOptions.push({value:s,label:e.name,count:e.count,indent:1,parent:r})})}),t}(t)):h(null)},[m]),(0,l.useEffect)(()=>{console.log("[Auto-Refresh] Starting background token monitoring (checks every minute)");let e=async()=>{w()<E.fT.FIVE_MINUTES&&await b()};e();let t=setInterval(e,E.fT.ONE_MINUTE);return()=>{clearInterval(t),console.log("[Auto-Refresh] Background token monitoring stopped")}},[e,p]),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,s.jsx)("div",{className:"w-full sm:w-auto sm:mr-4",children:(0,s.jsx)(a,{})}),(0,s.jsxs)("div",{className:"w-full sm:w-auto sm:flex-1 flex sm:justify-end items-center gap-2 sm:gap-3",children:[(0,s.jsxs)("button",{onClick:y,disabled:r||!v(),className:"btn btn-accent h-10 px-3 py-0 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1 flex-1 sm:flex-none",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),(0,s.jsx)("path",{d:"M21 3v5h-5"}),(0,s.jsx)("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}),(0,s.jsx)("path",{d:"M3 21v-5h5"})]}),r?i.length>0?"Syncing\xa0(".concat(i.length,")"):"Syncing...":"Sync"]}),t&&(0,s.jsxs)("button",{onClick:N,disabled:0===Object.keys(m.rawListings).length||o,className:"h-10 px-3 py-0 bg-blue-600 hover:bg-blue-700 border-blue-700 hover:border-blue-600 text-white rounded shadow transition-colors border disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1 flex-1 sm:flex-none",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),(0,s.jsx)("polyline",{points:"14,2 14,8 20,8"}),(0,s.jsx)("path",{d:"M12 18v-6"}),(0,s.jsx)("path",{d:"m9 15 3 3 3-3"})]}),o?"Publishing...":"Publish"]}),(0,s.jsxs)("button",{onClick:()=>window.location.href="/api/ebay/auth",className:"h-10 px-3 py-0 text-white rounded shadow transition-colors border flex-1 sm:flex-none ".concat(v()?"bg-green-600 hover:bg-green-700 border-green-700 hover:border-green-600":"bg-red-600 hover:bg-red-700 border-red-700 hover:border-red-600 animate-pulse"),children:[(0,s.jsx)("span",{className:"font-bold",children:v()?"✓":"✗"}),"\xa0Auth"]})]})]})}var M=r(9949);function R(){let{inventoryData:e}=(0,E.Xf)();return(0,s.jsx)("div",{className:"px-4 pb-0 h-full flex flex-col",children:(0,s.jsx)(M.A,{items:e,isShopMode:!1})})}let A=(0,o.F)({activeView:"research"});function O(){let{activeView:e,setActiveView:t}=A(),r=(0,n.useSearchParams)(),i=(0,n.useRouter)();return(0,l.useEffect)(()=>{let e=r.get("view");e&&["research","notes","inventory"].includes(e)&&t(e)},[]),(0,l.useEffect)(()=>{let t=new URLSearchParams(r);t.set("view",e);let s=window.location.hash;i.replace("?".concat(t.toString()).concat(s)),document.title=e.charAt(0).toUpperCase()+e.slice(1)},[e,r,i]),(0,s.jsxs)("div",{className:"h-screen flex flex-col",children:[(0,s.jsxs)("div",{className:"bg-slate-800 rounded-md shadow-md p-3 shrink-0 m-4 mb-4",children:[(0,s.jsx)("div",{className:"research"===e?"block":"hidden",children:(0,s.jsx)(j,{})}),(0,s.jsx)("div",{className:"notes"===e?"block":"hidden",children:(0,s.jsx)(p,{})}),(0,s.jsx)("div",{className:"inventory"===e?"block":"hidden",children:(0,s.jsx)(I,{})})]}),(0,s.jsxs)("div",{className:"flex-1 min-h-0 overflow-auto relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 ".concat("research"===e?"block":"hidden"),children:(0,s.jsx)(S,{})}),(0,s.jsx)("div",{className:"absolute inset-0 ".concat("notes"===e?"block":"hidden"),children:(0,s.jsx)(v,{})}),(0,s.jsx)("div",{className:"absolute inset-0 ".concat("inventory"===e?"block":"hidden"),children:(0,s.jsx)(R,{})})]}),(0,s.jsxs)("footer",{className:"text-center text-slate-500 text-xs py-1 shrink-0",children:["Copyright Andrew Spode of"," ",(0,s.jsx)("a",{href:"https://spodesabode.com",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Spode's Abode"})]})]})}function P(){return(0,s.jsx)(i.A,{children:(0,s.jsx)(O,{})})}},9949:(e,t,r)=>{r.d(t,{A:()=>c});var s=r(3365),n=r(1521),l=r(5301),i=r(1691);function o(e){let{categoryName:t,categoryTotal:r,selectedFilters:o,filteredItems:a,searchText:c,onToggleFilter:d,onClearFilters:u,onClearSearch:h,onClearCategory:m,isShopMode:x=!1}=e,[p,f]=(0,n.useState)(10),[g,w]=(0,n.useState)("recent"),[v,b]=(0,n.useState)(!1),[j,y]=(0,n.useState)(null),[k,N]=(0,n.useState)("description"),[C,L]=(0,n.useState)([]),[S,E]=(0,n.useState)(0),D=(0,n.useRef)(null),T=(0,n.useRef)(null),I=(0,n.useRef)(null),M=(0,n.useRef)(!1),R=(0,n.useRef)(a.length);(0,n.useEffect)(()=>{R.current!==a.length&&(f(10),I.current&&(I.current.scrollTop=0)),R.current=a.length},[a.length]),(0,n.useEffect)(()=>{f(10),I.current&&(I.current.scrollTop=0)},[g]),(0,n.useEffect)(()=>{if(a.length<=p)return;let e=I.current;if(!e)return;let t=()=>{if(!M.current)e.scrollTop+e.clientHeight>e.scrollHeight-200&&(M.current=!0,f(e=>e+10),M.current=!1)};return e.addEventListener("scroll",t),()=>{e.removeEventListener("scroll",t)}},[p,a.length]);let A=e=>"string"==typeof e&&e.includes("ebayimg.com")?e.replace(/(\$_)(\d+)(\.[A-Za-z]+)(\?|$)/,"$157$3$4"):e,O=e=>{if(e.pictureURLs&&e.pictureURLs.length>0){let t=e.pictureURLs.map(A);y(e),L(t),E(0),N("gallery"),b(!0)}},P=e=>{y(e),N("description"),b(!0)},B=()=>{(null==j?void 0:j.pictureURLs)&&j.pictureURLs.length>0&&(L(j.pictureURLs.map(A)),E(0),N("gallery"))},U=()=>{N("description")},F=()=>{E(e=>e===C.length-1?0:e+1)},W=()=>{E(e=>0===e?C.length-1:e-1)},_=()=>{b(!1),y(null)},H=e=>{if(v)switch(e.key){case"ArrowLeft":"gallery"===k&&(W(),e.preventDefault());break;case"ArrowRight":"gallery"===k&&(F(),e.preventDefault());break;case"Tab":"gallery"===k?U():B(),e.preventDefault();break;case"Escape":_(),e.preventDefault()}};(0,n.useEffect)(()=>{if(v)return window.addEventListener("keydown",H),()=>{window.removeEventListener("keydown",H)}},[v,S,C.length,k]),(0,n.useEffect)(()=>{let e="#modal"===window.location.hash;v&&!e?history.pushState(null,"",window.location.pathname+window.location.search+"#modal"):!v&&e&&history.back()},[v]),(0,n.useEffect)(()=>{let e=e=>{"#modal"!==window.location.hash&&v&&_()};return window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[v]);let G=e=>{let{name:t,value:r}=e,n=Array.isArray(r)?r.join(", "):r;return(0,s.jsxs)("div",{className:"inline-flex items-center bg-slate-700 text-xs rounded px-2 py-1",children:[(0,s.jsxs)("span",{className:"mr-1 text-blue-300",children:[t,":"]}),(0,s.jsx)("span",{className:"text-slate-300",children:n})]})},{setActiveView:z}=(0,l.usePageState)(),{setTriggerSearch:V}=(0,i.O)(),q=e=>{V(e.title),z("research")},X=e=>{let{item:t,onImageClick:r,onTitleClick:n,transparent:l=!1,isShopMode:i=!1}=e,o=parseFloat(t.price)||0,a=(e=>{let t,r=parseFloat(e)||0;return t=.1+.07*Math.min(r,20),r>20&&(t+=.04*Math.min(r-20,280)),r>300&&(t+=.02*Math.min(r-300,3700)),t})(o),c=(e=>{let t=Math.floor(e),r=e-t;return .01>Math.abs(r-.49)||.01>Math.abs(r-.99)?e:[t-1+.99,t+.49,t+.99].reduce((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t)})(o+a),d=null;return t.specifics&&(d=Object.entries(t.specifics).map((e,t)=>{let[r,n]=e;return(0,s.jsx)(G,{name:r,value:n},t)})),(0,s.jsxs)("div",{className:"".concat(l?"bg-transparent":"bg-slate-800"," py-2 rounded-md mb-4"),children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"relative ml-0 mr-4",children:[(0,s.jsx)("img",{src:t.pictureURLs[0],alt:"Product image loading...",title:t.title,className:"w-24 h-24 sm:w-40 sm:h-40 object-cover rounded-md cursor-pointer hover:opacity-90 transition-opacity",loading:"lazy",onClick:()=>r&&r(t)}),t.pictureURLs.length>1&&(0,s.jsx)("div",{className:"absolute top-1 right-1 bg-slate-800 bg-opacity-70 text-white text-xs rounded-full p-1",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"9",y:"3",width:"12",height:"12",rx:"2",ry:"2"}),(0,s.jsx)("rect",{x:"3",y:"9",width:"12",height:"12",rx:"2",ry:"2"})]})})]}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white font-medium group",children:(0,s.jsx)("span",{onClick:()=>n&&n(t),className:"hover:text-blue-300 cursor-pointer transition-colors duration-200",title:"View details",children:t.title})}),(0,s.jsxs)("p",{className:"text-slate-400 text-sm",children:[(0,s.jsxs)("span",{className:"text-green-400",children:["\xa3",c.toFixed(2)]}),(0,s.jsxs)("span",{className:"text-slate-500 text-xs",children:[" (\xa3",o.toFixed(2)," + \xa3",a.toFixed(2)," fees)"]})]})]}),(d||!i)&&(0,s.jsxs)("div",{className:"hidden sm:flex sm:flex-wrap mt-2 gap-1",children:[!i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("a",{href:"https://www.ebay.co.uk/lstng?mode=ReviseItem&itemId=".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center bg-blue-700 text-white text-xs rounded px-2 py-1 hover:bg-blue-600 transition-colors duration-200",title:"Edit on eBay",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,s.jsx)("a",{href:"https://www.ebay.co.uk/itm/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center bg-green-700 text-white text-xs rounded px-2 py-1 hover:bg-green-600 transition-colors duration-200",title:"View on eBay",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M10 6H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),(0,s.jsx)("button",{onClick:()=>q(t),className:"inline-flex items-center bg-purple-700 text-white text-xs rounded px-2 py-1 hover:bg-purple-600 transition-colors duration-200",title:"Research this item",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,s.jsx)("path",{d:"m21 21-4.35-4.35"})]})})]}),d&&d]})]})]}),(d||!i)&&(0,s.jsxs)("div",{className:"sm:hidden mt-2 mx-0 flex flex-wrap gap-1",children:[!i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("a",{href:"https://www.ebay.co.uk/lstng?mode=ReviseItem&itemId=".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center bg-blue-700 text-white text-xs rounded px-2 py-1 hover:bg-blue-600 transition-colors duration-200",title:"Edit on eBay",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),(0,s.jsx)("a",{href:"https://www.ebay.co.uk/itm/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center bg-green-700 text-white text-xs rounded px-2 py-1 hover:bg-green-600 transition-colors duration-200",title:"View on eBay",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M10 6H6a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4M14 4h6m0 0v6m0-6L10 14"})})}),(0,s.jsx)("button",{onClick:()=>q(t),className:"inline-flex items-center bg-purple-700 text-white text-xs rounded px-2 py-1 hover:bg-purple-600 transition-colors duration-200",title:"Research this item",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,s.jsx)("path",{d:"m21 21-4.35-4.35"})]})})]}),d&&d]})]})};return(0,s.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,s.jsxs)("div",{className:"mb-3 flex justify-between items-center flex-shrink-0",children:[(0,s.jsxs)("button",{onClick:()=>window.dispatchEvent(new CustomEvent("switch-to-filters")),className:"sm:hidden px-2 py-1.5 rounded bg-blue-600 hover:bg-blue-500 text-white flex-shrink-0 flex items-center",title:"Back to filters",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"mr-1",children:(0,s.jsx)("polyline",{points:"15 18 9 12 15 6"})}),(0,s.jsx)("span",{className:"text-xs font-medium",children:"Filters"})]}),a.length>1&&(0,s.jsxs)("select",{value:g,onChange:e=>w(e.target.value),className:"text-xs p-1.5 bg-slate-700 text-white border border-slate-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"recent",children:"Recent First"}),(0,s.jsx)("option",{value:"oldestFirst",children:"Oldest First"}),(0,s.jsx)("option",{value:"priceAsc",children:"Price: Low to High"}),(0,s.jsx)("option",{value:"priceDesc",children:"Price: High to Low"})]})]}),((null==c?void 0:c.trim())||t&&"any"!==t||Object.keys(o).length>0)&&(0,s.jsxs)("div",{className:"mb-3 relative",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide flex-shrink-0",children:[+(null!=c&&!!c.trim())+ +("any"!==t)+Object.keys(o).length>0&&(0,s.jsx)("button",{onClick:()=>{h(),m(),u()},className:"px-2 py-1.5 rounded-md bg-slate-700 hover:bg-slate-800 text-slate-200 hover:text-slate-400 flex-shrink-0",title:"Clear all filters",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M3 6h18"}),(0,s.jsx)("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),(0,s.jsx)("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})]})}),(null==c?void 0:c.trim())&&(0,s.jsxs)("div",{className:"inline-flex items-center bg-blue-700 text-white text-sm rounded px-3 py-1.5 flex-shrink-0",children:[(0,s.jsx)("span",{className:"mr-1 text-blue-200",children:"Search:"}),c,(0,s.jsx)("button",{onClick:h,className:"ml-2 text-blue-300 hover:text-white",children:"\xd7"})]}),"any"!==t&&(0,s.jsxs)("div",{className:"inline-flex items-center bg-blue-700 text-white text-sm rounded px-3 py-1.5 flex-shrink-0",children:[(0,s.jsx)("span",{className:"mr-1 text-blue-200",children:"Category:"}),t,(0,s.jsx)("button",{onClick:m,className:"ml-2 text-blue-300 hover:text-white",children:"\xd7"})]}),Object.entries(o).map(e=>{let[t,r]=e;return r.map((e,r)=>(0,s.jsxs)("div",{className:"inline-flex items-center bg-blue-700 text-white text-sm rounded px-3 py-1.5 flex-shrink-0 ".concat(r>0?"border-l-2 border-blue-400 -ml-1.5":""),children:[0===r&&(0,s.jsxs)("span",{className:"mr-1 text-blue-200",children:[t,":"]}),e,(0,s.jsx)("button",{onClick:()=>d(t,e),className:"ml-2 text-blue-300 hover:text-white",children:"\xd7"})]},"".concat(t,"-").concat(e)))})]}),(0,s.jsx)("div",{className:"absolute top-0 right-0 w-8 h-full bg-gradient-to-l from-slate-800 to-transparent pointer-events-none"})]}),(0,s.jsx)("div",{className:"mb-0 text-sm text-slate-400 flex-shrink-0",children:t&&r&&a.length!==r?(0,s.jsxs)("span",{children:["Showing ",(0,s.jsx)("span",{className:"text-green-400",children:a.length}),"\xa0/\xa0",(0,s.jsx)("span",{className:"text-blue-400",children:r})," matches"]}):(0,s.jsxs)("span",{children:["Showing ",(0,s.jsx)("span",{className:"text-green-400",children:a.length})," matches"]})}),(0,s.jsxs)("div",{ref:I,className:"space-y-2 pr-4 flex-grow overflow-y-auto custom-scrollbar pt-0",children:[(()=>{let e=[...a];switch(g){case"priceAsc":return e.sort((e,t)=>parseFloat(e.price)-parseFloat(t.price));case"priceDesc":return e.sort((e,t)=>parseFloat(t.price)-parseFloat(e.price));case"oldestFirst":return e.sort((e,t)=>e.id.localeCompare(t.id));default:return e.sort((e,t)=>t.id.localeCompare(e.id))}})().slice(0,p).map(e=>(0,s.jsx)(X,{item:e,onImageClick:O,onTitleClick:P,isShopMode:x},e.id)),a.length>p&&(0,s.jsx)("div",{className:"py-4 text-center text-slate-400 text-sm",children:"Loading more items..."})]}),v&&j&&(0,s.jsxs)("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-95 z-50 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex-shrink-0 bg-slate-800 bg-opacity-90 border-b border-slate-600",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 pb-2",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-white truncate flex-1 pr-4",children:j.title}),(0,s.jsx)("button",{className:"text-slate-400 hover:text-white flex-shrink-0 p-1",onClick:_,children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 px-4 pb-4",children:[j.pictureURLs&&j.pictureURLs.length>0&&(0,s.jsxs)("button",{onClick:B,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm flex items-center gap-1",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,s.jsx)("circle",{cx:"9",cy:"9",r:"2"}),(0,s.jsx)("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"})]}),"Photos"]}),(0,s.jsxs)("button",{onClick:U,className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm flex items-center gap-1",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),(0,s.jsx)("polyline",{points:"14,2 14,8 20,8"}),(0,s.jsx)("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),(0,s.jsx)("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),(0,s.jsx)("polyline",{points:"10,9 9,9 8,9"})]}),"Details"]}),(0,s.jsxs)("a",{href:"https://www.ebay.co.uk/itm/".concat(j.id),target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white rounded text-sm flex items-center gap-1",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"eBay"]})]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-hidden",children:"gallery"===k?(0,s.jsxs)("div",{className:"relative h-full",children:[(0,s.jsxs)("div",{className:"absolute inset-0 pb-40 md:pb-32 flex items-center justify-center",children:[(0,s.jsx)("button",{className:"hidden md:flex bg-black bg-opacity-50 rounded-full p-2 text-white hover:bg-opacity-70 transition-opacity cursor-pointer absolute left-4 z-20",onClick:W,"aria-label":"Previous image",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,s.jsx)("img",{src:C[S],alt:"Gallery image ".concat(S+1),className:"object-contain cursor-pointer",style:{maxWidth:"100%",maxHeight:"100%"},onClick:F,onTouchStart:e=>{D.current=e.touches[0].clientX},onTouchMove:e=>{T.current=e.touches[0].clientX},onTouchEnd:()=>{if(!D.current||!T.current)return;let e=T.current-D.current;Math.abs(e)>50&&(e>0?W():F()),D.current=null,T.current=null}})}),(0,s.jsx)("button",{className:"hidden md:flex bg-black bg-opacity-50 rounded-full p-2 text-white hover:bg-opacity-70 transition-opacity cursor-pointer absolute right-4 z-20",onClick:F,"aria-label":"Next image",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"9 18 15 12 9 6"})})})]}),(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-slate-800",children:[(0,s.jsx)("div",{className:"w-full md:hidden py-4",children:(0,s.jsxs)("div",{className:"flex justify-center items-center gap-8 mb-3",children:[(0,s.jsx)("button",{className:"bg-black bg-opacity-50 rounded-full p-2 text-white hover:bg-opacity-70 transition-opacity cursor-pointer",onClick:W,"aria-label":"Previous image",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,s.jsxs)("div",{className:"bg-black bg-opacity-60 text-white px-4 py-2 rounded-full text-sm",children:[S+1," / ",C.length]}),(0,s.jsx)("button",{className:"bg-black bg-opacity-50 rounded-full p-2 text-white hover:bg-opacity-70 transition-opacity cursor-pointer",onClick:F,"aria-label":"Next image",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"9 18 15 12 9 6"})})})]})}),C.length>1&&(0,s.jsx)("div",{className:"w-full overflow-hidden py-3 border-t border-slate-700",children:(0,s.jsx)("div",{className:"flex justify-start md:justify-center items-center gap-2 overflow-x-auto px-2 w-full scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-transparent whitespace-nowrap",children:C.map((e,t)=>(0,s.jsx)("button",{onClick:()=>E(t),className:"w-14 h-14 flex-shrink-0 rounded-md overflow-hidden \n                              ".concat(t===S?"ring-2 ring-blue-500":"opacity-70 hover:opacity-100"),children:(0,s.jsx)("img",{src:e,alt:"Thumbnail ".concat(t+1),className:"w-full h-full object-cover"})},t))})}),(0,s.jsx)("div",{className:"hidden md:flex justify-center py-2",children:(0,s.jsxs)("div",{className:"bg-black bg-opacity-60 text-white px-4 py-2 rounded-full text-sm",children:[S+1," / ",C.length]})})]})]}):(0,s.jsx)("div",{className:"h-full flex flex-col",children:(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,s.jsx)(X,{item:j,onImageClick:B,transparent:!0,isShopMode:x}),(0,s.jsx)("div",{className:"text-slate-300 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:(e=>{if(!e)return"No description available";let t=document.createElement("div");t.innerHTML=e;let r=e=>{if(e.nodeType===Node.TEXT_NODE)return e.textContent;if(e.nodeType===Node.ELEMENT_NODE){let t=e.tagName.toLowerCase(),s="";for(let t of e.childNodes)s+=r(t);if("br"===t)return"<br>";if("p"===t)return s?"<p>".concat(s,"</p>"):"";if("div"===t)return s?"<div>".concat(s,"</div>"):"";let n=e.style||{},l=window.getComputedStyle?window.getComputedStyle(e):{},i="700"===n.fontWeight||"bold"===n.fontWeight||"700"===l.fontWeight||"bold"===l.fontWeight||"b"===t||"strong"===t,o="italic"===n.fontStyle||"italic"===l.fontStyle||"i"===t||"em"===t;return i&&o?"<strong><em>".concat(s,"</em></strong>"):i?"<strong>".concat(s,"</strong>"):o?"<em>".concat(s,"</em>"):s}return""};return r(t)})(j.description)}})]})})})]})]})}function a(e){let{attrName:t,attrData:r,selectedAttribute:n,selectedFilters:l,onSelectAttribute:i,onToggleFilter:o}=e,a=n===t;return(0,s.jsxs)("div",{className:"bg-slate-800 py-1 rounded-md mb-1",children:[(0,s.jsxs)("h3",{className:"text-white font-medium mb-1 cursor-pointer hover:text-blue-400",onClick:()=>i(a?null:t),children:[t,(0,s.jsx)("span",{className:"float-right text-sm",children:a?"▼":"▶"})]}),a&&(0,s.jsx)("div",{className:"mt-1 space-y-0.5",children:Object.entries(r.values).sort((e,t)=>"Not Set"===e[0]?-1:"Not Set"===t[0]?1:e[0].localeCompare(t[0])).map(e=>{var n;let[i,a]=e,c=Math.round(a.count/r.totalInCategory*100),d=(null==(n=l[t])?void 0:n.includes(i))||!1,u="Not Set"===i;return(0,s.jsxs)("div",{className:"flex items-center py-0.5 px-2 rounded-sm cursor-pointer ".concat(d?"bg-blue-700":"hover:bg-slate-700"),onClick:()=>o(t,i),children:[(0,s.jsx)("span",{className:"".concat(d?"text-white":"text-slate-300"," text-sm truncate flex-grow ").concat(u?"italic":""),children:i}),(0,s.jsxs)("div",{className:"flex items-center flex-shrink-0 w-32",children:[(0,s.jsx)("div",{className:"w-14 bg-slate-700 rounded-full h-1.5 mr-2",children:(0,s.jsx)("div",{className:"".concat(d?"bg-blue-300":u?"bg-orange-500":"bg-blue-500"," h-1.5 rounded-full"),style:{width:"".concat(c,"%")}})}),(0,s.jsx)("span",{className:"text-xs ".concat(d?"text-blue-200":"text-slate-400"," w-14 text-right"),children:a.count})]})]},i)})})]})}function c(e){let{items:t,isShopMode:r=!1,onShowInfo:l}=e,[i,a]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(null),[x,p]=(0,n.useState)({}),[f,g]=(0,n.useState)(null),[w,v]=(0,n.useState)([]),[b,j]=(0,n.useState)(!1),[y,k]=(0,n.useState)(""),[N,C]=(0,n.useState)(""),[L,S]=(0,n.useState)(0);(0,n.useEffect)(()=>{t&&a(t)},[t]);let E=(0,n.useRef)(null),D=()=>{C(""),k(""),E.current&&clearTimeout(E.current)};(0,n.useEffect)(()=>{let e,t;if(!i)return;let r=h||"any",s=i;if(y.trim()){let e=y.toLowerCase().trim().split(/\s+/).filter(e=>e.length>0),t={},r={};Object.entries(i.items).forEach(s=>{let[n,l]=s;l.searchText&&e.every(e=>l.searchText.includes(e))&&(t[n]=l,Object.entries(i.itemsByCategory).forEach(e=>{let[t,s]=e;s.includes(n)&&(r[t]||(r[t]=[]),r[t].push(n))}))}),s={...i,items:t,itemsByCategory:r}}if("any"===r)e=Object.keys(s.items),t="All Categories";else{let[n,l]=r.split(":");t=l,e=s.itemsByCategory[r]||[]}let n={productType:t,listingCount:e.length,attributes:{}},l={};e.forEach(e=>{let t=s.items[e];t&&t.specifics&&Object.entries(t.specifics).forEach(r=>{let[s,n]=r;n&&(l[s]||(l[s]={values:{},totalInCategory:0,uniqueItemsWithAttribute:new Set}),l[s].uniqueItemsWithAttribute.add(e),(Array.isArray(n)?n:[n]).forEach(r=>{if(!r)return;let n=r.toString().trim();l[s].values[n]||(l[s].values[n]={count:0,listings:[]}),l[s].values[n].count++,l[s].totalInCategory++,l[s].values[n].listings.some(t=>t.id===e)||l[s].values[n].listings.push({id:e,title:t.title,price:t.price,pictureURLs:t.pictureURLs})}))})}),Object.keys(l).forEach(t=>{let r=l[t];r.uniqueItemCount=r.uniqueItemsWithAttribute.size;let n=e.length-r.uniqueItemCount;n>0&&(r.values["Not Set"]={count:n,listings:e.filter(e=>!r.uniqueItemsWithAttribute.has(e)).map(e=>{let t=s.items[e];return{id:e,title:t.title,price:t.price,pictureURLs:t.pictureURLs}})},r.totalInCategory+=n),delete r.uniqueItemsWithAttribute}),n.attributes=l,u(n),v(e.map(e=>s.items[e]))},[i,h,y]),(0,n.useEffect)(()=>{g(null),p({})},[h,y]),(0,n.useEffect)(()=>{let e;if(!i)return void v([]);if(y.trim()){let t=y.toLowerCase().trim().split(/\s+/).filter(e=>e.length>0);e=Object.keys(i.items).filter(e=>{let r=i.items[e];return!!r.searchText&&t.every(e=>r.searchText.includes(e))})}else{let t=h||"any";e="any"===t?Object.keys(i.items):i.itemsByCategory[t]||[]}let t=e,r=h||"any";if(y.trim()&&"any"!==r){let s=i.itemsByCategory[r]||[];t=e.filter(e=>s.includes(e))}Object.keys(x).length>0&&(t=t.filter(e=>{let t=i.items[e];return!!t&&!!t.specifics&&Object.entries(x).every(e=>{let[r,s]=e;if(0===s.length)return!0;let n=s.includes("Not Set"),l=s.some(e=>"Not Set"!==e),i=t.specifics[r],o=!i;if(n&&!l)return o;if(n&&l){if(o)return!0;let e=Array.isArray(i)?i:[i];return s.some(t=>"Not Set"!==t&&e.some(e=>e.toString().trim()===t))}if(!n){if(o)return!1;let e=Array.isArray(i)?i:[i];return s.some(t=>e.some(e=>e.toString().trim()===t))}return!1})})),v(t.map(e=>i.items[e]))},[i,y,h,x]);let T=(e,t)=>{p(r=>{let s={...r};return s[e]||(s[e]=[]),s[e].includes(t)?(s[e]=s[e].filter(e=>e!==t),0===s[e].length&&delete s[e]):s[e]=[...s[e],t],s})},I=e=>{g(null),p({}),m(e),e&&setTimeout(()=>{R(1)},100)},M=(0,n.useRef)(null),R=e=>{if(M.current){let t=e*window.innerWidth;M.current.scrollTo({left:t,behavior:"smooth"})}};return(0,n.useEffect)(()=>{let e=()=>R(0);window.addEventListener("switch-to-filters",e);let t=e=>{window.innerWidth>=640||"#results"!==window.location.hash&&R(0)},r=()=>{!(window.innerWidth>=640)&&M.current&&S(+(M.current.scrollLeft>0))};window.addEventListener("popstate",t);let s=M.current;return s&&s.addEventListener("scrollend",r),()=>{window.removeEventListener("switch-to-filters",e),window.removeEventListener("popstate",t),s&&s.removeEventListener("scrollend",r)}},[]),(0,n.useEffect)(()=>{if(window.innerWidth>=640)return;let e="#results"===window.location.hash;1!==L||e?0===L&&e&&history.back():history.pushState(null,"",window.location.pathname+window.location.search+"#results")},[L]),(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{ref:M,className:"flex overflow-x-auto snap-x snap-mandatory w-full h-full",children:[(0,s.jsxs)("div",{className:"snap-start w-full flex-shrink-0 flex-grow-0 bg-slate-800 px-4 pt-4 pb-4 pr-2 rounded-md shadow-md mr-4 sm:mr-4 sm:w-1/3 sm:flex-shrink sm:flex-grow overflow-hidden flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 flex-shrink-0",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-white",children:"Search & Refine"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 pr-2",children:[r&&l&&(0,s.jsx)("button",{onClick:l,className:"w-7 h-7 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center font-bold text-sm shadow-md",title:"Show information",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,s.jsx)("path",{d:"M12 16v-4"}),(0,s.jsx)("path",{d:"M12 8h.01"})]})}),(0,s.jsxs)("button",{onClick:()=>R(1,!0),className:"sm:hidden px-2 py-1.5 rounded bg-green-600 hover:bg-green-500 text-white text-xs font-medium flex items-center",children:[(0,s.jsx)("span",{children:"Results"}),(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"ml-1",children:(0,s.jsx)("polyline",{points:"9 18 15 12 9 6"})})]})]})]}),i?(0,s.jsx)(d,{inventoryData:i,productAttributes:c,selectedProductType:h,selectedFilters:x,selectedAttribute:f,showRareAttributes:b,filteredItems:w,searchText:N,onProductTypeChange:I,onToggleFilter:T,onSelectAttribute:g,onToggleRareAttributes:()=>j(e=>!e),onClearFilters:()=>p({}),onSearchChange:e=>{C(e),E.current&&clearTimeout(E.current),!h&&e.trim()&&m("any"),E.current=setTimeout(()=>{k(e)},300)},onClearSearch:D,onSearchSubmit:()=>{N.trim()&&R(1)},onShowInfo:l,isShopMode:r}):(0,s.jsx)("div",{className:"text-slate-400 text-sm",children:"No Inventory! Do you need to sync?"})]}),(0,s.jsx)("div",{className:"snap-start w-full flex-shrink-0 flex-grow-0 bg-slate-800 px-4 pt-4 pb-4 pr-2 rounded-md shadow-md sm:w-2/3 sm:flex-shrink sm:flex-grow overflow-hidden flex flex-col",children:(0,s.jsx)("div",{className:"flex-grow overflow-y-hidden",children:i?(0,s.jsx)(o,{categoryName:h?h.includes(":")?h.split(":").pop().trim():h:null,categoryTotal:c?c.listingCount:null,selectedFilters:x,filteredItems:w,searchText:y,onToggleFilter:T,onClearFilters:()=>p({}),onClearSearch:D,onClearCategory:()=>I("any"),isShopMode:r}):(0,s.jsx)("div",{className:"text-slate-400 text-sm p-4 bg-slate-700 rounded-md",children:"No Inventory! Do you need to sync?"})})})]})})}function d(e){let{inventoryData:t,productAttributes:r,selectedProductType:n,selectedFilters:l,selectedAttribute:i,showRareAttributes:o,filteredItems:c,searchText:d,onProductTypeChange:u,onToggleFilter:h,onSelectAttribute:m,onToggleRareAttributes:x,onClearFilters:p,onSearchChange:f,onClearSearch:g,onSearchSubmit:w,onShowInfo:v,isShopMode:b}=e;return t?(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex-shrink-0 pr-2",children:[(0,s.jsx)("p",{className:"mb-4 text-xs text-slate-400",children:"Use any combination of free text, category and filters."}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),w()},className:"relative",children:[(0,s.jsx)("input",{type:"text",value:d,onChange:e=>f(e.target.value),onKeyDown:e=>{"Enter"===e.key&&w()},placeholder:"Search items... (e.g. 'socket 478', 'AGP motherboard', 'ASUS')",className:"w-full p-2 bg-slate-700 text-white rounded border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500 pr-8"}),d&&(0,s.jsx)("button",{type:"button",onClick:g,className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-white",title:"Clear search",children:"✕"})]})}),(()=>{if(!t||!t.categoryOptions||0===t.categoryOptions.length)return null;let e=(()=>{if(!(null==d?void 0:d.trim()))return null;let e=d.toLowerCase().trim().split(/\s+/).filter(e=>e.length>0),r=new Set;return Object.entries(t.items).forEach(s=>{let[n,l]=s;l.searchText&&e.every(e=>l.searchText.includes(e))&&Object.entries(t.itemsByCategory).forEach(e=>{let[t,s]=e;s.includes(n)&&r.add(t)})}),r})();return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("select",{value:n||"",onChange:e=>u(e.target.value),className:"w-full p-2 pr-8 bg-slate-800 text-white rounded border border-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500 truncate appearance-none",style:{minWidth:0,backgroundImage:"url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e\")",backgroundPosition:"right 0.5rem center",backgroundRepeat:"no-repeat",backgroundSize:"1.5em 1.5em"},children:[(0,s.jsx)("option",{value:"",disabled:!0,children:"Filter by category..."}),(0,s.jsx)("option",{value:"any",children:"All Categories"}),t.categoryOptions.map(t=>{let r=!e||e.has(t.value),n=t.isGroup||!r&&e;return(0,s.jsx)("option",{value:t.value,disabled:n,className:t.isGroup?"font-bold text-blue-300":"",style:{paddingLeft:t.indent?"".concat(20*t.indent,"px"):"0",color:t.isGroup?"#93c5fd":!r&&e?"#64748b":void 0,opacity:!r&&e?.5:1},children:t.isGroup?"".concat(t.label," (").concat(t.count," items)"):"".concat(t.indent?"└ ":"").concat(t.label," (").concat(t.count,")")},t.value||t.label)})]}),c.length>0&&(0,s.jsxs)("div",{className:"mt-4 mb-4 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"text-sm text-slate-400",children:[(0,s.jsx)("span",{className:"text-green-400",children:c.length})," matching items",r&&c.length!==r.listingCount&&(0,s.jsxs)("span",{children:[" out of ",(0,s.jsx)("span",{className:"text-blue-400",children:r.listingCount})," total"]})]}),Object.keys(l).length>0&&(0,s.jsx)("button",{onClick:p,className:"text-xs text-blue-400 hover:text-blue-300 underline",children:"Clear all filters"})]})]})})()]}),(0,s.jsx)("div",{className:"flex-grow overflow-y-auto custom-scrollbar pb-10 pr-2",children:(()=>{if(!r)return null;if(0===Object.keys(r.attributes).length)return(0,s.jsx)("div",{className:"text-slate-400 italic text-sm p-3 bg-slate-800 rounded-md",children:"No detailed attributes found for this product type."});let e=r.listingCount,t=1===e?1:Math.max(2,Math.ceil(.25*e)),n=Object.entries(r.attributes).filter(e=>{let[r,s]=e;return"Category"!==r&&"Product Type"!==r&&(!!o||!(s.uniqueItemCount<t))}).sort((e,t)=>{var r,s;let n=e[1].totalInCategory-((null==(r=e[1].values["Not Set"])?void 0:r.count)||0);return t[1].totalInCategory-((null==(s=t[1].values["Not Set"])?void 0:s.count)||0)-n});if(0===n.length)return(0,s.jsx)("div",{className:"text-slate-400 italic text-sm p-3 bg-slate-800 rounded-md",children:"No attributes to display with current filters."});let c=Object.entries(r.attributes).filter(e=>{let[t,r]=e;return"Category"!==t&&"Product Type"!==t}).filter(e=>{let[r,s]=e;return s.uniqueItemCount<t}).length;return(0,s.jsxs)("div",{children:[n.map(e=>{let[t,r]=e;return(0,s.jsx)(a,{attrName:t,attrData:r,selectedAttribute:i,selectedFilters:l,onSelectAttribute:m,onToggleFilter:h},t)}),c>0&&(0,s.jsx)("div",{className:"p-2 bg-slate-700 rounded-md flex items-center justify-center mt-4",children:(0,s.jsx)("button",{onClick:x,className:"text-blue-300 hover:text-blue-100 text-sm",children:o?"Show fewer attributes":"Show ".concat(c," more attributes")})})]})})()})]}):(0,s.jsx)("div",{children:"Loading data..."})}}}]);